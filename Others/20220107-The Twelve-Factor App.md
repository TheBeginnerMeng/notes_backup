# The Twelve-Factor App

## 1. 基准代码

一份基准代码（Codebase），多份部署（Deploys）

一份用来跟踪代码所有修订版本的数据库被称作 *代码库*（code repository, code repo, repo）。

在 Git 那样的分布式版本控制系统中，*基准代码* 则是指最上游的那份代码库。

![一份代码库对应多份部署](https://12factor.net/images/codebase-deploys.png)

所有部署的基准代码相同，但每份部署可以使用其不同的版本。比如，开发人员可能有一些提交还没有同步至预发布环境；预发布环境也有一些提交没有同步至生产环境。但它们都共享一份基准代码，我们就认为它们只是相同应用的不同部署而已。

## 2. 依赖

显式声明依赖关系（dependency）

## 3. 配置

在环境中存储配置

通常，应用的 *配置* 在不同 [部署](https://12factor.net/zh_cn/codebase) (预发布、生产环境、开发环境等等)间会有很大差异。这其中包括：

- 数据库，Memcached，以及其他 [后端服务](https://12factor.net/zh_cn/backing-services) 的配置
- 第三方服务的证书，如 Amazon S3、Twitter 等
- 每份部署特有的配置，如域名等

判断一个应用是否正确地将配置排除在代码之外，一个简单的方法是看该应用的基准代码是否可以立刻开源，而不用担心会暴露任何敏感的信息。

**12-Factor推荐将应用的配置存储于 *环境变量* 中**（ *env vars*, *env* ）。环境变量可以非常方便地在不同的部署间做修改，却不动一行代码；与配置文件不同，不小心把它们签入代码库的概率微乎其微；与一些传统的解决配置问题的机制（比如 Java 的属性配置文件）相比，环境变量与语言和系统无关。

## 4. 后端服务

把后端服务当作附加资源

*后端服务*是指程序运行所需要的通过网络调用的各种服务，如数据库（[MySQL](http://dev.mysql.com/)，[CouchDB](http://couchdb.apache.org/)），消息/队列系统（[RabbitMQ](http://www.rabbitmq.com/)，[Beanstalkd](https://beanstalkd.github.io/)），SMTP 邮件发送服务（[Postfix](http://www.postfix.org/)），以及缓存系统（[Memcached](http://memcached.org/)）。

每个不同的后端服务是一份 *资源* 。例如，一个 MySQL 数据库是一个资源，两个 MySQL 数据库（用来数据分区）就被当作是 2 个不同的资源。12-Factor 应用将这些数据库都视作 *附加资源* ，这些资源和它们附属的部署保持松耦合。

## 5. 构建，发布，运行

严格分离构建和运行过程

[基准代码](https://12factor.net/zh_cn/codebase) 转化为一份部署(非开发环境)需要以下三个阶段：

- *构建阶段* 是指将代码仓库转化为可执行包的过程。构建时会使用指定版本的代码，获取和打包 [依赖项](https://12factor.net/zh_cn/dependencies)，编译成二进制文件和资源文件。
- *发布阶段* 会将构建的结果和当前部署所需 [配置](https://12factor.net/zh_cn/config) 相结合，并能够立刻在运行环境中投入使用。
- *运行阶段* （或者说“运行时”）是指针对选定的发布版本，在执行环境中启动一系列应用程序 [进程](https://12factor.net/zh_cn/processes)。

## 6. 进程

以一个或多个无状态进程运行应用

**12-Factor 应用的进程必须无状态且 [无共享](http://en.wikipedia.org/wiki/Shared_nothing_architecture) 。** 任何需要持久化的数据都要存储在 [后端服务](https://12factor.net/zh_cn/backing-services) 内，比如数据库。

## 7. 端口绑定

通过端口绑定提供服务

**12-Factor 应用完全自我加载** 而不依赖于任何网络服务器就可以创建一个面向网络的服务。互联网应用 **通过端口绑定来提供服务** ，并监听发送至该端口的请求。

在线上环境中，请求统一发送至公共域名而后路由至绑定了端口的网络进程。

## 8. 并发

通过进程模型进行扩展

## 9. 易处理

快速启动和优雅终止，可最大化健壮性

## 10. 开发环境与线上环境等价

尽可能的保持开发，预发布，线上环境相同

## 11. 日志

把日志当作事件流

日志应该是 [事件流](https://adam.herokuapp.com/past/2011/4/1/logs_are_streams_not_files/) 的汇总，将所有运行中进程和后端服务的输出流按照时间顺序收集起来。尽管在回溯问题时可能需要看很多行，日志最原始的格式确实是一个事件一行。日志没有确定开始和结束，但随着应用在运行会持续的增加。

## 12. 管理进程

后台管理任务当作一次性进程运行

